"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=e(),t=!0),!t){var n=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=n,o}}}(function(){function s(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var o in n)t[o]=n[o]}return t}function l(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(u){function r(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=s({path:"/"},r.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var o=JSON.stringify(t);/^[\{\[]/.test(o)&&(t=o)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var i in n)n[i]&&(a+="; "+i,!0!==n[i]&&(a+="="+n[i].split(";")[0]));return document.cookie=e+"="+t+a}}function t(e,t){if("undefined"!=typeof document){for(var n={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var i=o[a].split("="),r=i.slice(1).join("=");t||'"'!==r.charAt(0)||(r=r.slice(1,-1));try{var s=l(i[0]);if(r=(u.read||u)(r,s)||l(r),t)try{r=JSON.parse(r)}catch(e){}if(n[s]=r,e===s)break}catch(e){}}return e?n[e]:n}}return r.set=n,r.get=function(e){return t(e,!1)},r.getJSON=function(e){return t(e,!0)},r.remove=function(e,t){n(e,"",s(t,{expires:-1}))},r.defaults={},r.withConverter=e,r}(function(){})});var fmRESTorJS=function(){function s(e,t,n,o,a){var i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;_classCallCheck(this,s),this.host=e,this.database=t,this.layout=n,this.user=o,this.password=a,this.fmDataSource=r,this._apiToken=null,this._token={saveTo:"localStorage",expire:14,name:"fm-data-api"},null!==i&&this.setOptions(i)}return _createClass(s,[{key:"setTokenExpiration",value:function(e){this._token.expire=e}},{key:"setTokenName",value:function(e){this._token.name=e}},{key:"setTokenSaveTo",value:function(e){this._token.saveTo=e}},{key:"setAPIToken",value:function(e){this._apiToken=e}},{key:"getAPIToken",value:function(){return this._apiToken}},{key:"setOptions",value:function(e){if("token"in e){var t=e.token;"name"in t&&this.setTokenName(t.name),"saveTo"in t&&["localStorage","cookie"].includes(t.saveTo)&&this.setTokenSaveTo(t.saveTo),"expiration"in t&&Number.isInteger(t.expiration)&&this.setTokenExpiration(t.expiration)}}},{key:"isLogged",value:function(){var e=void 0;if(void 0===(e="localStorage"===this._token.saveTo?localStorage.getItem(this._token.name)||void 0:Cookies.get(this._token.name)||void 0))return!1;var t=JSON.parse(e),n=new Date;return!(new Date(t.expire)<=n)&&(this.setAPIToken(t.token),!0)}},{key:"extendTokenExpiration",value:function(){var e=new Date;e.setMinutes(e.getMinutes()+this._token.expire);var t={expire:e,token:this.getAPIToken()};"localStorage"===this._token.saveTo?localStorage.setItem(this._token.name,JSON.stringify(t)):Cookies.set(this._token.name,JSON.stringify(t))}},{key:"getProductInformation",value:function(n,o){var a=this;this._callURL({endpoint:"/fmi/data/vLatest/productInfo",method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return(a.isResultError(e)?o:n)(t)}).catch(function(e){return o(e)})}},{key:"getDatabaseNames",value:function(n,o){var a=this;this._callURL({headers:{Authorization:"Basic "+btoa(this.user+":"+this.password)},endpoint:"/fmi/data/vLatest/databases",method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return(a.isResultError(e)?o:n)(t)}).catch(function(e){return o(e)})}},{key:"getScriptNames",value:function(n,o){var a=this;this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/vLatest/databases/"+this.database+"/scripts/",method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"getLayoutNames",value:function(n,o){var a=this;this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/vLatest/databases/"+this.database+"/layouts/",method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"getLayoutMetadata",value:function(n,o){var a=this;this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/vLatest/databases/"+this.database+"/layouts/"+this.layout,method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"createRecord",value:function(e,n,o){var a=this;this._callURL({headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records",method:"POST"},e).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"deleteRecord",value:function(e,t,n,o){var a=this,i=1<arguments.length&&void 0!==t?t:null,r=2<arguments.length?n:void 0,s=3<arguments.length?o:void 0,u="";null!==i&&(u=this.convertObjectToGetParameters(i)),this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/"+e+"?"+u,method:"DELETE"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?s(t):(a.extendTokenExpiration(),r(t))}).catch(function(e){return s(e)})}},{key:"duplicateRecord",value:function(e,t,n,o){var a=this,i=1<arguments.length&&void 0!==t?t:null,r=2<arguments.length?n:void 0,s=3<arguments.length?o:void 0;this._callURL({headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/"+e,method:"POST"},i).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?s(t):(a.extendTokenExpiration(),r(t))}).catch(function(e){return s(e)})}},{key:"editRecord",value:function(e,t,n,o){var a=this;this._callURL({headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/"+e,method:"PATCH"},t).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"getRecord",value:function(e,t,n,o){var a=this,i=1<arguments.length&&void 0!==t?t:null,r=2<arguments.length?n:void 0,s=3<arguments.length?o:void 0,u="";null!==i&&(u=this.convertObjectToGetParameters(i)),this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/"+e+"?"+u,method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?s(t):(a.extendTokenExpiration(),r(t))}).catch(function(e){return s(e)})}},{key:"getRecords",value:function(e,t,n){var o=this,a=0<arguments.length&&void 0!==e?e:null,i=1<arguments.length?t:void 0,r=2<arguments.length?n:void 0,s="";null!==a&&(s=this.convertObjectToGetParameters(a)),this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/?"+s,method:"GET"}).then(function(e){var t=o.getResultFromRequestRespnse(e);return o.isResultError(e)?r(t):(o.extendTokenExpiration(),i(t))}).catch(function(e){return r(e)})}},{key:"findRecords",value:function(e,n,o){var a=this;this._callURL({headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/_find/",method:"POST"},e).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"setGlobalField",value:function(e,n,o){var a=this;this._callURL({headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/globals/",method:"PATCH"},e).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.extendTokenExpiration(),n(t))}).catch(function(e){return o(e)})}},{key:"uploadFileToContainter",value:function(e,t,n,o,a,i){var r=this,s=new FormData;s.append("upload",o),this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/records/"+e+"/containers/"+t+"/"+n,method:"POST"},s,!0).then(function(e){var t=r.getResultFromRequestRespnse(e);return r.isResultError(e)?i(t):(r.extendTokenExpiration(),a(t))}).catch(function(e){return i(e)})}},{key:"runScript",value:function(e,t,n,o){var a=this,i=1<arguments.length&&void 0!==t?t:null,r=2<arguments.length?n:void 0,s=3<arguments.length?o:void 0,u="";null!==i&&(u=this.convertObjectToGetParameters(i)),this._callURL({headers:{Authorization:"Bearer "+this.getAPIToken()},endpoint:"/fmi/data/v1/databases/"+this.database+"/layouts/"+this.layout+"/script/"+e+"?"+u,method:"GET"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?s(t):(a.extendTokenExpiration(),r(t))}).catch(function(e){return s(e)})}},{key:"login",value:function(n,o){var a=this;if(this.isLogged())return n(!0);var e=null;return null!==this.fmDataSource&&(e={fmDataSource:this.fmDataSource}),this._callURL({headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa(this.user+":"+this.password)},endpoint:"/fmi/data/v1/databases/"+this.database+"/sessions/",method:"POST"},e).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):(a.setAPIToken(t.response.token),a.extendTokenExpiration(),n(!0))}).catch(function(e){return o(e)})}},{key:"logout",value:function(n,o){var a=this;if(!this.isLogged())return n(!0);this._callURL({endpoint:"/fmi/data/v1/databases/"+this.database+"/sessions/"+this.getAPIToken(),method:"DELETE"}).then(function(e){var t=a.getResultFromRequestRespnse(e);return a.isResultError(e)?o(t):("localStorage"===a._token.saveTo?localStorage.removeItem(a._token.name):Cookies.remove(a._token.name),n(!0))}).catch(function(e){return o(e)})}},{key:"_callURL",value:function(e,t,n){var o=1<arguments.length&&void 0!==t?t:null,a=2<arguments.length&&void 0!==n&&n,i={method:e.method};return"headers"in e&&(i.headers=e.headers),null!==o&&!1===a&&(i.body=JSON.stringify(o)),null!==o&&!0===a&&(i.body=o),fetch("https://"+this.host+e.endpoint,i).then(function(t){return t.json().then(function(e){return{status:t.status,result:e}})}).then(function(e){return e})}},{key:"getResultFromRequestRespnse",value:function(e){return e.result}},{key:"isResultError",value:function(e){if(!("status"in e))return!0;return!![400,401,403,404,405,415,500].includes(e.status)}},{key:"convertObjectToGetParameters",value:function(e){var t="";for(var n in e)""!=t&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]);return t}}]),s}();
//# sourceMappingURL=fmRESTorJS.js.map
